
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
            max-width: 1500px;
            width: 100%;
            position: relative;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
            gap: 10px;
        }

        .title {
            font-size: 30px;
            font-weight: bold;
            color: #333;
            display:flex;
            align-items:center;
            gap:10px;
        }

        .header-actions{
            display:flex;
            gap:10px;
            align-items:center;
        }

        .btn {
            background: #8b5cf6;
            color: white;
            border: none;
            padding: 10px 14px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 800;
            transition: background 0.25s, transform 0.05s;
            white-space: nowrap;
        }
        .btn:hover { background: #7c3aed; }
        .btn:active { transform: scale(0.98); }

        .btn.secondary{ background:#10b981; }
        .btn.secondary:hover{ background:#059669; }

        .btn.ghost{
            background:#eef2ff;
            color:#4338ca;
        }
        .btn.ghost:hover{ background:#e0e7ff; }

        .info-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 14px;
            gap: 10px;
        }

        .info-box {
            padding: 10px 14px;
            border-radius: 10px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            min-width: 0;
        }

        .score-box { background: #fef3c7; color: #92400e; }
        .stage-box { background: #e9d5ff; color: #6b21a8; flex: 1.2; }
        .next-box  { background: #dbeafe; color: #1e40af; font-size: 14px; justify-content: space-between; }

        .stage-title {
            font-weight: 900;
            overflow:hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .next-note {
            min-width: 160px;
            height: 32px;
            border-radius: 999px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 900;
            padding: 0 12px;
            flex: 0 0 auto;
            white-space: nowrap;
        }

        .goals {
            background: linear-gradient(to right, #eff6ff, #f5f3ff);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 16px;
        }

        .goals-title {
            font-size: 14px;
            font-weight: 900;
            color: #374151;
            margin-bottom: 8px;
            display:flex;
            justify-content: space-between;
            align-items:center;
            gap:10px;
        }

        .goals-title .sub{
            font-weight: 800;
            color:#6b7280;
            font-size: 12px;
            white-space: nowrap;
        }

        .goals-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .goal-item {
            padding: 6px 12px;
            border-radius: 999px;
            background: white;
            font-size: 13px;
            font-weight: 900;
            border: 1px solid rgba(0,0,0,0.06);
        }

        .goal-item.complete {
            background: #10b981;
            color: white;
            border-color: transparent;
        }

        .canvas-container { position: relative; display: flex; justify-content: center; }
        canvas {
            border: 4px solid #d1d5db;
            border-radius: 12px;
            cursor: pointer;
            max-width: 100%;
            height: auto;
        }

        .overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: white;
            padding: 20px;
            text-align:center;
        }

        .overlay h2 { font-size: 34px; margin-bottom: 12px; }
        .overlay p  { font-size: 18px; margin-bottom: 18px; opacity: .95; }
        .overlay .row{ display:flex; gap:10px; flex-wrap:wrap; justify-content:center; }

        .overlay button {
            background: #8b5cf6;
            color: white;
            border: none;
            padding: 12px 22px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 900;
            cursor: pointer;
            transition: background 0.3s;
        }
        .overlay button:hover { background: #7c3aed; }
        .overlay button.next-stage { background: #10b981; }
        .overlay button.next-stage:hover { background: #059669; }
        .overlay button.pick-stage { background: #eef2ff; color:#4338ca; }
        .overlay button.pick-stage:hover { background:#e0e7ff; }

        .instructions {
            margin-top: 20px;
            padding: 16px;
            background: #f3f4f6;
            border-radius: 10px;
        }

        .instructions h3 { font-weight: 900; color: #1f2937; margin-bottom: 8px; }
        .instructions ul { list-style: none; font-size: 13px; color: #4b5563; }
        .instructions li { margin-bottom: 4px; }

        /* Stage select screen */
        .stage-select {
            width: min(720px, 100%);
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 34px;
        }
        .stage-select h1{
            font-size: 34px;
            font-weight: 900;
            color:#111827;
            display:flex;
            align-items:center;
            gap:10px;
        }
        .stage-select p{
            color:#6b7280;
            margin-top:10px;
            font-weight: 700;
            line-height: 1.45;
        }
        .stage-grid{
            margin-top:18px;
            display:grid;
            grid-template-columns: repeat(2, minmax(0,1fr));
            gap: 14px;
        }
        @media (max-width: 620px){
            .stage-grid{ grid-template-columns: 1fr; }
        }
        .stage-card{
            border: 1px solid rgba(0,0,0,0.08);
            border-radius: 18px;
            padding: 14px;
            background: linear-gradient(to right, #eff6ff, #f5f3ff);
            cursor:pointer;
            transition: transform .05s ease, box-shadow .2s ease, border-color .2s ease;
        }
        .stage-card:hover{
            transform: translateY(-1px);
            box-shadow: 0 10px 24px rgba(0,0,0,0.12);
            border-color: rgba(139,92,246,0.45);
        }
        .stage-card .name{
            font-weight: 900;
            color:#111827;
            font-size: 16px;
            display:flex;
            align-items:center;
            justify-content: space-between;
            gap:10px;
        }
        .stage-card .pill{
            font-size: 12px;
            font-weight: 900;
            padding: 6px 10px;
            border-radius: 999px;
            background:#fff;
            border:1px solid rgba(0,0,0,0.06);
            color:#4338ca;
            white-space: nowrap;
        }
        .stage-card .goals-mini{
            margin-top:10px;
            display:flex;
            flex-wrap:wrap;
            gap:8px;
        }
        .mini{
            font-size: 12px;
            font-weight: 900;
            padding: 6px 10px;
            border-radius: 999px;
            background:#fff;
            border:1px solid rgba(0,0,0,0.06);
            color:#374151;
        }
        .mini.muted{
            color:#9ca3af;
        }

        .hidden{ display:none !important; }
    

/* ===== Codex modular layout additions ===== */
.game-layout{
  display:flex;
  gap:18px;
  align-items:flex-start;
}

.game-left{
  flex:0 0 auto;
}

.game-right{
  flex: 1 1 auto;
  min-width: 560px;
}

.score-panel{
  background: #f8fafc;
  border-radius: 18px;
  padding: 12px;
  border: 1px solid rgba(0,0,0,0.06);
}

.score-panel-header{
  display:flex;
  align-items:baseline;
  justify-content:space-between;
  gap:12px;
  padding: 4px 6px 10px 6px;
}

.score-title{
  font-weight: 900;
  font-size: 16px;
  color: #111827;
}

.score-sub{
  font-size: 12px;
  color: #6b7280;
  font-weight: 700;
}

.score-svg-wrap{
  width: 100%;
  min-height: 420px;
  overflow: hidden;
  border-radius: 14px;
  background: white;
  border: 1px solid rgba(0,0,0,0.06);
}

/* keep canvas aspect ratio (400x600 => 2/3) */
.canvas-container{
  width: min(560px, 100%);
  aspect-ratio: 2 / 3;
  height: auto !important;
  overflow:hidden;
}

#gameCanvas{
  width: 100%;
  height: 100%;
  display:block;
}


/* ===== Score pedagogical effects ===== */
#scoreSvgWrap.score-faded svg { opacity: 0.70; transition: opacity 220ms ease; }
#scoreSvgWrap.score-faded svg g.vf-stavenote{
  opacity: 0.22;
  transition: opacity 220ms ease, filter 220ms ease, transform 220ms ease;
}
#scoreSvgWrap.score-faded svg g.vf-stavenote.score-note-revealed{ opacity: 1 !important; }
#scoreSvgWrap.score-faded svg g.vf-stavenote.score-note-flash{
  filter: drop-shadow(0 0 12px rgba(255, 200, 0, 0.95));
  transform-box: fill-box;
  transform-origin: center;
  transform: scale(1.07);
}
